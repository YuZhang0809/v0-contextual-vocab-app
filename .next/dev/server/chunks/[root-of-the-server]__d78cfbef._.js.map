{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/v0-contextual-vocab-app/app/api/analyze/route.ts"],"sourcesContent":["import OpenAI from \"openai\"\r\nimport { z } from \"zod\"\r\n\r\nconst openai = new OpenAI({\r\n  baseURL: \"https://api.deepseek.com\",\r\n  apiKey: process.env.DEEPSEEK_API_KEY,\r\n})\r\n\r\nconst analysisSchema = z.object({\r\n  meaning: z.string(),\r\n  mnemonic: z.string(),\r\n})\r\n\r\nexport async function POST(req: Request) {\r\n  const { word, sentence } = await req.json()\r\n\r\n  if (!word || !sentence) {\r\n    return Response.json({ error: \"Word and sentence are required\" }, { status: 400 })\r\n  }\r\n\r\n  try {\r\n    const prompt = `你是一位专门用于解析文本并只返回JSON的AI。任何情况下都不要输出除了标准JSON对象之外的任何文字、解释或注释。\r\n\r\n请根据以下语境分析单词含义，并严格按照下面的JSON格式返回。\r\n\r\n单词: \"${word}\"\r\n原句: \"${sentence}\"\r\n\r\nJSON格式:\r\n{\r\n  \"meaning\": \"基于语境的中文释义（不超过15字）\",\r\n  \"mnemonic\": \"词根、谐音或联想助记提示（不超过30字）\"\r\n}`\r\n\r\n    const completion = await openai.chat.completions.create({\r\n      model: \"deepseek-chat\",\r\n      messages: [{ role: \"user\", content: prompt }],\r\n      response_format: { type: \"json_object\" },\r\n      max_tokens: 200,\r\n    })\r\n\r\n    const jsonString = completion.choices[0].message.content\r\n    if (!jsonString) {\r\n      throw new Error(\"AI did not return a response.\")\r\n    }\r\n\r\n    const object = JSON.parse(jsonString)\r\n    const validationResult = analysisSchema.safeParse(object)\r\n\r\n    if (!validationResult.success) {\r\n      throw new Error(`AI response validation failed: ${validationResult.error.message}`)\r\n    }\r\n\r\n    return Response.json(validationResult.data)\r\n  } catch (error) {\r\n    console.error(\"AI analysis error:\", error)\r\n    const errorDetails = error instanceof Error ? error.message : \"Unknown error\"\r\n    return Response.json(\r\n      { error: \"Failed to analyze word\", details: errorDetails },\r\n      { status: 500 },\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,SAAS,IAAI,uOAAM,CAAC;IACxB,SAAS;IACT,QAAQ,QAAQ,GAAG,CAAC,gBAAgB;AACtC;AAEA,MAAM,iBAAiB,2NAAC,CAAC,MAAM,CAAC;IAC9B,SAAS,2NAAC,CAAC,MAAM;IACjB,UAAU,2NAAC,CAAC,MAAM;AACpB;AAEO,eAAe,KAAK,GAAY;IACrC,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;IAEzC,IAAI,CAAC,QAAQ,CAAC,UAAU;QACtB,OAAO,SAAS,IAAI,CAAC;YAAE,OAAO;QAAiC,GAAG;YAAE,QAAQ;QAAI;IAClF;IAEA,IAAI;QACF,MAAM,SAAS,CAAC;;;;KAIf,EAAE,KAAK;KACP,EAAE,SAAS;;;;;;CAMf,CAAC;QAEE,MAAM,aAAa,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACtD,OAAO;YACP,UAAU;gBAAC;oBAAE,MAAM;oBAAQ,SAAS;gBAAO;aAAE;YAC7C,iBAAiB;gBAAE,MAAM;YAAc;YACvC,YAAY;QACd;QAEA,MAAM,aAAa,WAAW,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO;QACxD,IAAI,CAAC,YAAY;YACf,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,SAAS,KAAK,KAAK,CAAC;QAC1B,MAAM,mBAAmB,eAAe,SAAS,CAAC;QAElD,IAAI,CAAC,iBAAiB,OAAO,EAAE;YAC7B,MAAM,IAAI,MAAM,CAAC,+BAA+B,EAAE,iBAAiB,KAAK,CAAC,OAAO,EAAE;QACpF;QAEA,OAAO,SAAS,IAAI,CAAC,iBAAiB,IAAI;IAC5C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sBAAsB;QACpC,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAC9D,OAAO,SAAS,IAAI,CAClB;YAAE,OAAO;YAA0B,SAAS;QAAa,GACzD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}