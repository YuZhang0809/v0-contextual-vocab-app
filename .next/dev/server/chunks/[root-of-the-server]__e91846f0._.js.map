{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/v0-contextual-vocab-app/app/api/analyze/route.ts"],"sourcesContent":["import { deepseek } from \"@ai-sdk/deepseek\"\r\nimport { generateObject } from \"ai\"\r\nimport { z } from \"zod\"\r\n\r\n// Define a more flexible Schema\r\nconst analysisSchema = z.object({\r\n  is_sentence: z.boolean().describe(\"True if the input is a complete sentence, false if it is a word or phrase\"),\r\n  sentence_translation: z.string().optional().describe(\"Full sentence translation if the input is a sentence\"),\r\n  items: z.array(\r\n    z.object({\r\n      term: z.string().describe(\"The target word or phrase (Lemma/Base form)\"),\r\n      context_segment: z.string().describe(\"The actual segment in the sentence that matches the term\"),\r\n      meaning: z.string().describe(\"Precise Chinese meaning in this specific context (max 15 chars)\"),\r\n      example_sentence: z.string().describe(\"If input was a word: a generated example sentence. If input was a sentence: the original sentence.\"),\r\n    })\r\n  ).describe(\"List of learning items analyzed from the text\"),\r\n})\r\n\r\nexport async function POST(req: Request) {\r\n  // Accept unified 'text' field, and optional 'focus_term' for specific lookup\r\n  const { text, focus_term } = await req.json()\r\n\r\n  if (!text && !focus_term) {\r\n    return Response.json({ error: \"Text input is required\" }, { status: 400 })\r\n  }\r\n\r\n  // Construct Prompt based on mode\r\n  let prompt = \"\"\r\n  \r\n  if (focus_term) {\r\n    // Mode: Specific Lookup (Assistive Mode)\r\n    // User wants to know the meaning of 'focus_term', possibly within 'text' (context)\r\n    prompt = `You are an expert English language tutor. \r\n    \r\nTask: Explain the meaning of the specific term \"${focus_term}\".\r\n\r\nContext provided: \"${text || 'None'}\"\r\n\r\nRequirements:\r\n1. If context is provided, explain the meaning of \"${focus_term}\" specifically within that context.\r\n2. If context is missing or irrelevant, generate a new example sentence for \"${focus_term}\" and explain it.\r\n3. **OUTPUT**:\r\n   - Return exactly ONE item in the 'items' array.\r\n   - 'term': must be \"${focus_term}\".\r\n   - 'meaning': concise Chinese meaning (max 15 chars).\r\n   - 'example_sentence': the provided context (if valid) or the generated sentence.\r\n   - 'sentence_translation': optional.\r\n`\r\n  } else {\r\n    // Mode: General Analysis (Original Logic)\r\n    prompt = `You are an expert English language tutor. Analyze the user's input.\r\n\r\nUser Input: \"${text}\"\r\n\r\nLogic:\r\n1. Determine if the input is a \"Single Word/Phrase\" or a \"Complete Sentence\".\r\n2. **If Single Word/Phrase**:\r\n   - Generate a high-quality, natural English example sentence containing the word.\r\n   - The 'example_sentence' must be this generated sentence.\r\n   - Explain the word's meaning in this generated context.\r\n3. **If Complete Sentence**:\r\n   - Identify 1-3 difficult words or collocations worth learning from the sentence.\r\n   - Extract them as 'items'.\r\n   - 'example_sentence' must be the original user input sentence for all items.\r\n   - Provide the full sentence translation.\r\n\r\nConstraints:\r\n- NO mnemonics.\r\n- Meaning must be concise (Chinese).\r\n- 'context_segment' should be the exact text from the sentence.\r\n`\r\n  }\r\n\r\n  try {\r\n    const { object } = await generateObject({\r\n      model: deepseek(\"deepseek-chat\"),\r\n      schema: analysisSchema,\r\n      prompt: prompt,\r\n      maxOutputTokens: 1000,\r\n    })\r\n\r\n    return Response.json(object)\r\n  } catch (error) {\r\n    console.error(\"AI analysis error:\", error)\r\n    const errorDetails = error instanceof Error ? error.message : \"Unknown error\"\r\n    return Response.json(\r\n      { error: \"Failed to analyze text\", details: errorDetails },\r\n      { status: 500 },\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,gCAAgC;AAChC,MAAM,iBAAiB,2NAAC,CAAC,MAAM,CAAC;IAC9B,aAAa,2NAAC,CAAC,OAAO,GAAG,QAAQ,CAAC;IAClC,sBAAsB,2NAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;IACrD,OAAO,2NAAC,CAAC,KAAK,CACZ,2NAAC,CAAC,MAAM,CAAC;QACP,MAAM,2NAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;QAC1B,iBAAiB,2NAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;QACrC,SAAS,2NAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;QAC7B,kBAAkB,2NAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IACxC,IACA,QAAQ,CAAC;AACb;AAEO,eAAe,KAAK,GAAY;IACrC,6EAA6E;IAC7E,MAAM,EAAE,IAAI,EAAE,UAAU,EAAE,GAAG,MAAM,IAAI,IAAI;IAE3C,IAAI,CAAC,QAAQ,CAAC,YAAY;QACxB,OAAO,SAAS,IAAI,CAAC;YAAE,OAAO;QAAyB,GAAG;YAAE,QAAQ;QAAI;IAC1E;IAEA,iCAAiC;IACjC,IAAI,SAAS;IAEb,IAAI,YAAY;QACd,yCAAyC;QACzC,mFAAmF;QACnF,SAAS,CAAC;;gDAEkC,EAAE,WAAW;;mBAE1C,EAAE,QAAQ,OAAO;;;mDAGe,EAAE,WAAW;6EACa,EAAE,WAAW;;;sBAGpE,EAAE,WAAW;;;;AAInC,CAAC;IACC,OAAO;QACL,0CAA0C;QAC1C,SAAS,CAAC;;aAED,EAAE,KAAK;;;;;;;;;;;;;;;;;;AAkBpB,CAAC;IACC;IAEA,IAAI;QACF,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAA,8OAAc,EAAC;YACtC,OAAO,IAAA,iQAAQ,EAAC;YAChB,QAAQ;YACR,QAAQ;YACR,iBAAiB;QACnB;QAEA,OAAO,SAAS,IAAI,CAAC;IACvB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sBAAsB;QACpC,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAC9D,OAAO,SAAS,IAAI,CAClB;YAAE,OAAO;YAA0B,SAAS;QAAa,GACzD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}